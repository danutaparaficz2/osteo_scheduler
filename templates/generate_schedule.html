{% extends "base.html" %}

{% block title %}Generate Schedule - Timetable Scheduler{% endblock %}

{% block content %}
<h2 style="color: #667eea; margin-bottom: 30px;">Generate Schedule</h2>

<div id="message-container"></div>

<div style="max-width: 600px;">
    <div class="form-group">
        <label for="weeks">Number of Weeks:</label>
        <input type="number" id="weeks" value="1" min="1" max="52">
    </div>
    
    <button onclick="generateSchedule()" class="btn">Generate Timetable</button>
</div>

<div id="generation-status" style="margin-top: 30px;"></div>

<script>
function showMessage(message, type) {
    const container = document.getElementById('message-container');
    container.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
    setTimeout(() => container.innerHTML = '', 5000);
}

async function generateSchedule() {
    const weeks = parseInt(document.getElementById('weeks').value);
    
    if (!weeks || weeks < 1) {
        showMessage('Please enter a valid number of weeks', 'warning');
        return;
    }
    
    const statusDiv = document.getElementById('generation-status');
    statusDiv.innerHTML = '<p style="color: #667eea; font-weight: bold;">⏳ Generating timetable...</p>';
    
    try {
        const response = await fetch('/schedule/generate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                weeks: weeks,
                availability: []
            })
        });
        
        const result = await response.json();
        
        if (result.success) {
            showMessage(result.message, 'success');
            statusDiv.innerHTML = `
                <div class="alert alert-success">
                    <strong>✓ Success!</strong><br>
                    Timetable has been generated for ${weeks} week(s).<br>
                    <a href="/schedule/view" class="btn" style="margin-top: 15px;">View Schedule</a>
                </div>
            `;
        } else {
            showMessage(result.message, 'error');
            statusDiv.innerHTML = '';
        }
    } catch (error) {
        showMessage('Error generating schedule: ' + error.message, 'error');
        statusDiv.innerHTML = '';
    }
}
</script>
{% endblock %}
